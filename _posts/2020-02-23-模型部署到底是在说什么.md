---
layout:		post
title:  	部署模型到底是在说什么？
subtitle:   模型部署系列之一
date:       2020-02-23
author:     一轩明月
header-img: img/post-bg-future.jpg
catalog: 	 true
tags:
    - production
excerpt:    模型部署对不少数据科学从业者来说都是痛点，但一旦终端用户能稳定用上模型结果就能为组织、公司带来价值。所以从业者们必须懂得并抓住模型部署的本质，具备部署能力。而部署模型第一步就是要意识到所谓部署就是弄清终端用户与模型结果的交互方式。
---

学习机器学习的过程中，无论是自学还是听课，模型部署都是很少被提起的话题。训练营、研究生的数据科学项目以及在线课程都专注于算法训练和神经网络结构的构建上，因为它们是机器学习思想的“核心”。可是必须要意识到，如果一名数据科学从业者不能部署模型，那他就创造不出一丝一毫的商业价值。

技术工具五花八门，框架轮子日新月异，很多人都沉迷于这些所谓的“前沿”上，但似乎都还没回答过一个问题——部署模型是在说什么？

要理解”部署模型“的含义，需要加上软件工程的视角。软件工程师会怎么理解”发布“代码？发布代码的理念又是怎么迁移到机器学习领域来的呢？像软件工程师一样思考，暂时抛下数据科学家的视角，你会发现部署模型的含义变得异常清晰。

要理解算法模型的部署，先来简单看一下机器学习项目的生命周期。假设产品经理发现了某些用户需求，并判断这些需求适用于机器学习处理。于是，新项目立项或者通过机器学习强化既有项目，通常多数情况下是监督学习模型。

项目经理找到机器学习团队商量项目方案。确认了项目目标，选定好评价标准，规定代码基准。如果公司正好有适于训练和验证的数据，项目至此就甩给了数据科学家或机器学习工程师，他们会去一遍又一遍的搞特征工程和模型选择。

这阶段的**目标**是构建一个能满足甚至超越计划预期的预测模型。穷尽整个流程，推动这一项目创生的那些用户需求依然没被解决呢。即使模型预测性能已经达到了最低标准，离需求被满意的解决依然差的远。

![](https://raw.githubusercontent.com/LibertyDream/diy_img_host/master/img/2020-02-22_ml_lifecycle.png)

只有当模型预测结果为用户信赖，经常使用，它才算开始为组织带来价值。这期间的模型训练，使用户用上预测结果以及相关系统的配套就叫做**部署**。部署和常规机器学习任务，什么特征工程，模型选择还是模型评估都完全不同。

正因如此，部署的概念对于缺乏软件工程或 DevOps 背景的数据科学家和机器学习工程师来说并不是很好理解。所幸这些技能不难学，通过实践任何数据科学家都能掌握将模型部署到生产环境的法门。

## 如何确定部署方式

要判断怎么部署模型，你需要搞清楚终端用户和模型预测结果的交互方式。举几个例子便于理解，我们从简单场景开始逐步增加复杂度。

### 案例1：部署潜在用户打分模型

假设数据科学家给一群精通 SQL 的分析师搭好了一个潜在用户评分模型。分析师们想基于用户转化概率给新线索分桶。每天早上他们都会从数据库拿数据，制作或更新 BI 工具里的看板。

鉴于分析师会 SQL 并且希望模型评分存储在数据库中，“部署”评分模型就意味着每天定时给新线索打分，并把它们存进分析师的数据库中。

要想让模型带来价值，要抓住这里的部署关键点：

1. 能给予新线索做预测
2. 每天都能拿到预测结果
3. 预测结果要被存入数据库。

再来看一个稍复杂点的场景。

销售主管看到了模型，也想让他的客户经理们能用上模型预测结果。我们自然有些牢骚，客户经理不懂 SQL，把结果存入数据库已然不够。

产品经理认为潜在客户评分应该可视化的呈现到 CRM 工具里，CRM 客户经理每天都用，这样一来就能增加商业价值了。

之前案例的前两点依旧是重点，模型依然要为一群人每天生成一批预测结果，第三点就不是了。此时部署包括了评分从数据库到 CRM 工具的迁移，这可能意味着增加新的 ETL。

### 案例 2：部署推荐系统

最后再来考虑一个很流行的机器学习应用——推荐系统的部署问题。假设我们就职于一家电子商务公司，希望给用户们一些推荐商品促进销售。考虑两种场景：

- 场景一

公司希望无论用户是网页端还是电脑端都能看到产品推荐内容。推荐结果能对请求及时响应，请求可能在一天中的任意时刻发生。

这给我们的部署增加了延迟约束，决定了我们能否在用户登录时即时生成预测，还是必须提前生成并将推荐预测缓存起来。模型部署必须保证模型结果在移动端和 web 端都能访问，所以将部署与这些应用独立开来单独作为一个模块是个不错的选择。

- 场景二

公司想要给现有顾客们的营销邮件里增加五个推荐产品。客户一周会收到两封这样的邮件，一封周一下午发出，另一封则在周五清晨。

这个场景下，用户们的推荐内容可以统一计算并缓存。延迟要求没有之前的场景那么高。将这些推荐结果存在数据库里就足够了。邮件编辑程序可以从数据库里找到用户推荐内容并把前五项加入个性化邮件当中。

总结一下以上场景，当你考虑怎么部署机器学习模型的时候有这么一些因素要考虑：

1. 隔多久生成一次结果
2. 每次生成一个实例还是一批实例
3. 哪些模块会与模型发生交互，数量、接口形式
4. 这些访问请求对延迟的敏感度

模型部署对不少数据科学从业者来说都是痛点，但一旦终端用户能稳定用上模型结果就能为组织、公司带来价值。所以从业者们必须懂得并抓住模型部署的本质，具备部署能力。而部署模型第一步就是要意识到所谓部署就是弄清终端用户与模型结果的交互方式。