---
layout:		post
title:  	模型注册
subtitle:   模型部署系列之六
date:       2020-05-24
author:     一轩明月
header-img: img/post-bg-computer-vision.jpg
catalog:    true
tags:
    - production
excerpt:    
---

> 编译自：Model Registries for ML Deployment，[Luigi](https://mlinproduction.com/author/luigi/)

部署机器学习系列的前几篇文章中已经介绍了[离线](https://libertydream.github.io/2020/03/08/部署批量推断模式/)和[在线](https://libertydream.github.io/2020/05/17/部署实时推理/)两种模型部署方式，每篇文章都是依靠[模型部署时的接口设计](https://libertydream.github.io/2020/03/01/模型部署的软件接口/)中定义好的 `Model` 类进行存储和取回，地点通常是远端对象存储系统，像 Amazon S3 或是 Google Cloud Storage。这样保证模型独立训练或者完成推理过程，甚至可能是在独立的机器上。模型远程训练并存好后，推断的时候调用远程访问路径即可。

尽管系统已经将训练和推断分离了，它还欠缺在两个过程间传递信息的机制。比如，要怎样从训练进程向推理进程中注入文件路径？手动操作自然是一种选择，但我们更倾向“闭环”，最好是能自动化机器学习模型的部署。

我们需要一个针对训练完毕的 ML 模型的中心化跟踪系统，也称为**模型注册**。类似于[域名注册](https://en.wikipedia.org/wiki/Domain_name_registry)和[容器注册](https://en.wikipedia.org/wiki/Domain_name_registry)，模型注册系统是一个数据库，其中存储着模型谱系、版本和其他配置信息。本文会介绍什么是模型注册，怎么实现简单的模型注册以及一个借助 [MLflow](https://www.mlflow.org/docs/latest/model-registry.html) 实现的开源注册系统。

# 模型注册

机器学习模型注册系统是一个中心化追踪系统，存储着已发布模型的谱系、版本及相关元数据。注册系统会基于审计目的收集监管数据，比如是谁训练发布的模型，哪个数据集被用于训练，衡量预测质量的评判标准是否真有价值，以及何时模型被部署上线。模型注册主要解决了两个问题：

- 首先，注册本身提供了一种存储模型元数据的机制
- 其次，注册充当了沟通层，将原本独立的模型训练和推断进程“连接”到了一起。设计实现良好的注册系统能保证推断进程会正确地选择已发布模型来进行预测

那么哪些模型元数据需要我们存入注册系统呢？一般而言，这要视系统和公司需求而定。强约束行业内机器学习应用需要详细的审计记录，因而全面存储元数据必不可少。约束较少的行业可能不需要那么多细节，但也要看的长远些，随着模型团队和应用（与用户）数的增长，系统规模也会扩大，元数据采集不能成为瓶颈。

让我们从要存入模型注册系统的最小元数据集开始。对每个已注册模型，要存一个识别器、名称、版本添加日期、由评估标准确认的模型预测质量以及模型部署阶段。部署阶段包括 _开发，影子模式或上线产品_，但也可能随需扩展。

还有些数据可能会想加进去：

- 可读性良好的模型目标阐述
- 可读性良好的当下模型与此前模型的差异描述
- 用哪个数据集训练的
- 模型生成代码的 git hash 或 Docker 镜像 ID
- 训练时间之类的运行时指标
- 谁发布的模型